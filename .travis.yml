sudo: required
dist: trusty

language: node_js

node_js:
  - "6"

services:
  - rabbitmq

before_script:
  - sudo rabbitmq-plugins enable rabbitmq_management
  - wget http://guest:guest@localhost:15672/cli/rabbitmqadmin
  - sudo chmod +x rabbitmqadmin
  - sudo mv rabbitmqadmin /usr/local/bin/
  - sudo rabbitmqctl add_vhost "pino-mq"
  - sudo rabbitmqctl add_user "pinomqusr" "pinomqpwd"
  - sudo rabbitmqctl set_user_tags "pinomqusr" "management"
  - sudo rabbitmqctl set_permissions -p "pino-mq" "pinomqusr" ".*" ".*" ".*"

script:
  - npm run coverage
  - npm run coverage:check
  - ./test/e2e/RabbitMQConfig.sh
